(function(){var localStorage = window.localStorage; var f,r,p,w,c,G,y,D,g,s,i,l,A,j,x,z,B,H,k,m,v,o,F,e,I,C,n,t,d,u,a,b=[].indexOf||function(L){for(var K=0,J=this.length;K<J;K++){if(K in this&&this[K]===L){return K}}return -1},q={}.hasOwnProperty,E=function(M,K){for(var J in K){if(q.call(K,J)){M[J]=K[J]}}function L(){this.constructor=M}L.prototype=K.prototype;M.prototype=new L();M.__super__=K.prototype;return M};f=function(){return null};f.Util={};f.EventSource=(function(){function J(K){this._cancelable=K&&K.cancelable;this._listeners=[]}J.prototype.addListener=function(K){if(typeof K!=="function"){throw new TypeError("Invalid listener type; expected function")}if(b.call(this._listeners,K)<0){this._listeners.push(K)}return this};J.prototype.removeListener=function(Q){var M,L,N,P,K,O;if(this._listeners.indexOf){L=this._listeners.indexOf(Q);if(L!==-1){this._listeners.splice(L,1)}}else{O=this._listeners;for(M=P=0,K=O.length;P<K;M=++P){N=O[M];if(N===Q){this._listeners.splice(M,1);break}}}return this};J.prototype.dispatch=function(M){var P,L,O,K,N;N=this._listeners;for(O=0,K=N.length;O<K;O++){P=N[O];L=P(M);if(this._cancelable&&L===false){return false}}return true};return J})();f.ApiError=(function(){J.prototype.status=void 0;J.prototype.method=void 0;J.prototype.url=void 0;J.prototype.responseText=void 0;J.prototype.response=void 0;J.NETWORK_ERROR=0;J.INVALID_PARAM=400;J.INVALID_TOKEN=401;J.OAUTH_ERROR=403;J.NOT_FOUND=404;J.INVALID_METHOD=405;J.RATE_LIMITED=503;J.OVER_QUOTA=507;function J(O,P,L){var N,K;this.method=P;this.url=L;this.status=O.status;if(O.responseType){try{N=O.response||O.responseText}catch(M){K=M;try{N=O.responseText}catch(M){K=M;N=null}}}else{try{N=O.responseText}catch(M){K=M;N=null}}if(N){try{this.responseText=N.toString();this.response=JSON.parse(N)}catch(M){K=M;this.response=null}}else{this.responseText="(no response)";this.response=null}}J.prototype.toString=function(){return"Dropbox API error "+this.status+" from "+this.method+" "+this.url+" :: "+this.responseText};J.prototype.inspect=function(){return this.toString()};return J})();f.AuthDriver=(function(){function J(){}J.prototype.url=function(K){return"https://some.url?dboauth_token="+(f.Xhr.urlEncode(K))};J.prototype.doAuthorize=function(K,L,M,N){return N("oauth-token")};J.prototype.onAuthStateChange=function(K,L){return L()};return J})();f.Drivers={};if(typeof j==="function"&&typeof m==="function"){j=function(J){return window.atob(J)};m=function(J){return window.btoa(J)}}else{if((typeof window!=="undefined"||typeof self!=="undefined")&&(typeof navigator!=="undefined"&&typeof navigator.userAgent==="string")){z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";v=function(M,L,J){var N,K;K=3-L;M<<=K*8;N=3;while(N>=K){J.push(z.charAt((M>>(N*6))&63));N-=1}N=L;while(N<3){J.push("=");N+=1}return null};x=function(L,N,J){var M,K;K=4-N;L<<=K*6;M=2;while(M>=K){J.push(String.fromCharCode((L>>(8*M))&255));M-=1}return null};m=function(M){var L,K,N,J,P,O;J=[];L=0;K=0;for(N=P=0,O=M.length;0<=O?P<O:P>O;N=0<=O?++P:--P){L=(L<<8)|M.charCodeAt(N);K+=1;if(K===3){v(L,K,J);L=K=0}}if(K>0){v(L,K,J)}return J.join("")};j=function(K){var L,Q,P,M,J,O,N;J=[];L=0;P=0;for(M=O=0,N=K.length;0<=N?O<N:O>N;M=0<=N?++O:--O){Q=K.charAt(M);if(Q==="="){break}L=(L<<6)|z.indexOf(Q);P+=1;if(P===4){x(L,P,J);L=P=0}}if(P>0){x(L,P,J)}return J.join("")}}else{j=function(J){var K,L;K=new Buffer(J,"base64");return((function(){var O,N,M;M=[];for(L=O=0,N=K.length;0<=N?O<N:O>N;L=0<=N?++O:--O){M.push(String.fromCharCode(K[L]))}return M})()).join("")};m=function(J){var K,L;K=new Buffer((function(){var O,N,M;M=[];for(L=O=0,N=J.length;0<=N?O<N:O>N;L=0<=N?++O:--O){M.push(J.charCodeAt(L))}return M})());return K.toString("base64")}}}f.Util.atob=j;f.Util.btoa=m;f.Client=(function(){function J(K){var L=this;this.sandbox=K.sandbox||false;this.apiServer=K.server||this.defaultApiServer();this.authServer=K.authServer||this.defaultAuthServer();this.fileServer=K.fileServer||this.defaultFileServer();this.downloadServer=K.downloadServer||this.defaultDownloadServer();this.onXhr=new f.EventSource({cancelable:true});this.onError=new f.EventSource;this.onAuthStateChange=new f.EventSource;this.xhrOnErrorHandler=function(M,N){return L.handleXhrError(M,N)};this.oauth=new f.Oauth(K);this.driver=null;this.filter=null;this.uid=null;this.authState=null;this.authError=null;this._credentials=null;this.setCredentials(K);this.setupUrls()}J.prototype.authDriver=function(K){this.driver=K;return this};J.prototype.onXhr=null;J.prototype.onError=null;J.prototype.onAuthStateChange=null;J.prototype.dropboxUid=function(){return this.uid};J.prototype.credentials=function(){if(!this._credentials){this.computeCredentials()}return this._credentials};J.prototype.authenticate=function(M,P){var K,L,N,O=this;if(!P&&typeof M==="function"){P=M;M=null}if(M&&"interactive" in M){K=M.interactive}else{K=true}if(!(this.driver||this.authState===w.DONE)){throw new Error("Call authDriver to set an authentication driver")}if(this.authState===w.ERROR){throw new Error("Client got in an error state. Call reset() to reuse it!")}L=null;N=function(){var Q;if(L!==O.authState){L=O.authState;if(O.driver&&O.driver.onAuthStateChange){O.driver.onAuthStateChange(O,N);return}}switch(O.authState){case w.RESET:if(!K){if(P){P(null,O)}return}return O.requestToken(function(R,U){var S,T;if(R){O.authError=R;O.authState=w.ERROR}else{S=U.oauth_token;T=U.oauth_token_secret;O.oauth.setToken(S,T);O.authState=w.REQUEST}O._credentials=null;O.onAuthStateChange.dispatch(O);return N()});case w.REQUEST:if(!K){if(P){P(null,O)}return}Q=O.authorizeUrl(O.oauth.token);return O.driver.doAuthorize(Q,O.oauth.token,O.oauth.tokenSecret,function(){O.authState=w.AUTHORIZED;O._credentials=null;O.onAuthStateChange.dispatch(O);return N()});case w.AUTHORIZED:return O.getAccessToken(function(R,S){if(R){O.authError=R;O.authState=w.ERROR}else{O.oauth.setToken(S.oauth_token,S.oauth_token_secret);O.uid=S.uid;O.authState=w.DONE}O._credentials=null;O.onAuthStateChange.dispatch(O);return N()});case w.DONE:if(P){P(null,O)}break;case w.SIGNED_OFF:O.authState=w.RESET;O.reset();return N();case w.ERROR:if(P){P(O.authError,O)}}};N();return this};J.prototype.isAuthenticated=function(){return this.authState===w.DONE};J.prototype.signOut=function(M){var K,L=this;K=new f.Xhr("POST",this.urls.signOut);K.signWithOauth(this.oauth);return this.dispatchXhr(K,function(N){if(N){if(M){M(N)}return}L.authState=w.RESET;L.reset();L.authState=w.SIGNED_OFF;L.onAuthStateChange.dispatch(L);if(L.driver&&L.driver.onAuthStateChange){return L.driver.onAuthStateChange(L,function(){if(M){return M(N)}})}else{if(M){return M(N)}}})};J.prototype.signOff=function(K){return this.signOut(K)};J.prototype.getUserInfo=function(L,N){var K,M;if((!N)&&(typeof L==="function")){N=L;L=null}K=false;if(L&&L.httpCache){K=true}M=new f.Xhr("GET",this.urls.accountInfo);M.signWithOauth(this.oauth,K);return this.dispatchXhr(M,function(P,O){return N(P,f.UserInfo.parse(O),O)})};J.prototype.readFile=function(S,T,P){var M,L,K,O,Q,N,R;if((!P)&&(typeof T==="function")){P=T;T=null}L={};N="text";O=null;M=false;if(T){if(T.versionTag){L.rev=T.versionTag}else{if(T.rev){L.rev=T.rev}}if(T.arrayBuffer){N="arraybuffer"}else{if(T.blob){N="blob"}else{if(T.buffer){N="buffer"}else{if(T.binary){N="b"}}}}if(T.length){if(T.start!=null){Q=T.start;K=T.start+T.length-1}else{Q="";K=T.length}O="bytes="+Q+"-"+K}else{if(T.start!=null){O="bytes="+T.start+"-"}}if(T.httpCache){M=true}}R=new f.Xhr("GET",""+this.urls.getFile+"/"+(this.urlEncodePath(S)));R.setParams(L).signWithOauth(this.oauth,M);R.setResponseType(N);if(O){if(O){R.setHeader("Range",O)}R.reportResponseHeaders()}return this.dispatchXhr(R,function(V,X,W,Y){var U;if(Y){U=f.RangeInfo.parse(Y["content-range"])}else{U=null}return P(V,X,f.Stat.parse(W),U)})};J.prototype.writeFile=function(N,M,L,O){var K;if((!O)&&(typeof L==="function")){O=L;L=null}K=f.Xhr.canSendForms&&typeof M==="object";if(K){return this.writeFileUsingForm(N,M,L,O)}else{return this.writeFileUsingPut(N,M,L,O)}};J.prototype.writeFileUsingForm=function(N,M,K,R){var Q,P,L,O;L=N.lastIndexOf("/");if(L===-1){Q=N;N=""}else{Q=N.substring(L);N=N.substring(0,L)}P={file:Q};if(K){if(K.noOverwrite){P.overwrite="false"}if(K.lastVersionTag){P.parent_rev=K.lastVersionTag}else{if(K.parentRev||K.parent_rev){P.parent_rev=K.parentRev||K.parent_rev}}}O=new f.Xhr("POST",""+this.urls.postFile+"/"+(this.urlEncodePath(N)));O.setParams(P).signWithOauth(this.oauth).setFileField("file",Q,M,"application/octet-stream");delete P.file;return this.dispatchXhr(O,function(S,T){if(R){return R(S,f.Stat.parse(T))}})};J.prototype.writeFileUsingPut=function(M,L,K,P){var O,N;O={};if(K){if(K.noOverwrite){O.overwrite="false"}if(K.lastVersionTag){O.parent_rev=K.lastVersionTag}else{if(K.parentRev||K.parent_rev){O.parent_rev=K.parentRev||K.parent_rev}}}N=new f.Xhr("POST",""+this.urls.putFile+"/"+(this.urlEncodePath(M)));N.setBody(L).setParams(O).signWithOauth(this.oauth);return this.dispatchXhr(N,function(Q,R){if(P){return P(Q,f.Stat.parse(R))}})};J.prototype.resumableUploadStep=function(K,N,O){var M,L;if(N){M={offset:N.offset};if(N.tag){M.upload_id=N.tag}}else{M={offset:0}}L=new f.Xhr("POST",this.urls.chunkedUpload);L.setBody(K).setParams(M).signWithOauth(this.oauth);return this.dispatchXhr(L,function(P,Q){if(P&&P.status===f.ApiError.INVALID_PARAM&&P.response&&P.response.upload_id&&P.response.offset){return O(null,f.UploadCursor.parse(P.response))}else{return O(P,f.UploadCursor.parse(Q))}})};J.prototype.resumableUploadFinish=function(L,O,K,P){var N,M;if((!P)&&(typeof K==="function")){P=K;K=null}N={upload_id:O.tag};if(K){if(K.lastVersionTag){N.parent_rev=K.lastVersionTag}else{if(K.parentRev||K.parent_rev){N.parent_rev=K.parentRev||K.parent_rev}}if(K.noOverwrite){N.overwrite="false"}}M=new f.Xhr("POST",""+this.urls.commitChunkedUpload+"/"+(this.urlEncodePath(L)));M.setParams(N).signWithOauth(this.oauth);return this.dispatchXhr(M,function(Q,R){if(P){return P(Q,f.Stat.parse(R))}})};J.prototype.stat=function(M,L,P){var K,O,N;if((!P)&&(typeof L==="function")){P=L;L=null}O={};K=false;if(L){if(L.version!=null){O.rev=L.version}if(L.removed||L.deleted){O.include_deleted="true"}if(L.readDir){O.list="true";if(L.readDir!==true){O.file_limit=L.readDir.toString()}}if(L.cacheHash){O.hash=L.cacheHash}if(L.httpCache){K=true}}O.include_deleted||(O.include_deleted="false");O.list||(O.list="false");N=new f.Xhr("GET",""+this.urls.metadata+"/"+(this.urlEncodePath(M)));N.setParams(O).signWithOauth(this.oauth,K);return this.dispatchXhr(N,function(R,S){var Q,U,T;T=f.Stat.parse(S);if(S!=null?S.contents:void 0){Q=(function(){var Y,W,X,V;X=S.contents;V=[];for(Y=0,W=X.length;Y<W;Y++){U=X[Y];V.push(f.Stat.parse(U))}return V})()}else{Q=void 0}return P(R,T,Q)})};J.prototype.readdir=function(M,K,N){var L;if((!N)&&(typeof K==="function")){N=K;K=null}L={readDir:true};if(K){if(K.limit!=null){L.readDir=K.limit}if(K.versionTag){L.versionTag=K.versionTag}if(K.removed||K.deleted){L.removed=K.removed||K.deleted}if(K.httpCache){L.httpCache=K.httpCache}}return this.stat(M,L,function(P,Q,S){var O,R;if(S){O=(function(){var V,U,T;T=[];for(V=0,U=S.length;V<U;V++){R=S[V];T.push(R.name)}return T})()}else{O=null}return N(P,O,Q,S)})};J.prototype.metadata=function(L,K,M){return this.stat(L,K,M)};J.prototype.makeUrl=function(R,S,O){var P,M,L,K,Q,N=this;if((!O)&&(typeof S==="function")){O=S;S=null}if(S&&(S["long"]||S.longUrl||S.downloadHack)){M={short_url:"false"}}else{M={}}R=this.urlEncodePath(R);L=""+this.urls.shares+"/"+R;P=false;K=false;if(S){if(S.downloadHack){P=true;K=true}else{if(S.download){P=true;L=""+this.urls.media+"/"+R}}}Q=new f.Xhr("POST",L).setParams(M).signWithOauth(this.oauth);return this.dispatchXhr(Q,function(U,T){if(K&&(T!=null?T.url:void 0)){T.url=T.url.replace(N.authServer,N.downloadServer)}return O(U,f.PublicUrl.parse(T,P))})};J.prototype.history=function(M,L,P){var K,O,N;if((!P)&&(typeof L==="function")){P=L;L=null}O={};K=false;if(L){if(L.limit!=null){O.rev_limit=L.limit}if(L.httpCache){K=true}}N=new f.Xhr("GET",""+this.urls.revisions+"/"+(this.urlEncodePath(M)));N.setParams(O).signWithOauth(this.oauth,K);return this.dispatchXhr(N,function(R,Q){var T,S;if(Q){S=(function(){var W,V,U;U=[];for(W=0,V=Q.length;W<V;W++){T=Q[W];U.push(f.Stat.parse(T))}return U})()}else{S=void 0}return P(R,S)})};J.prototype.revisions=function(L,K,M){return this.history(L,K,M)};J.prototype.thumbnailUrl=function(L,K){var M;M=this.thumbnailXhr(L,K);return M.paramsToUrl().url};J.prototype.readThumbnail=function(M,L,O){var K,N;if((!O)&&(typeof L==="function")){O=L;L=null}K="b";if(L){if(L.blob){K="blob"}if(L.arrayBuffer){K="arraybuffer"}if(L.buffer){K="buffer"}}N=this.thumbnailXhr(M,L);N.setResponseType(K);return this.dispatchXhr(N,function(P,R,Q){return O(P,R,f.Stat.parse(Q))})};J.prototype.thumbnailXhr=function(L,K){var N,M;N={};if(K){if(K.format){N.format=K.format}else{if(K.png){N.format="png"}}if(K.size){N.size=K.size}}M=new f.Xhr("GET",""+this.urls.thumbnails+"/"+(this.urlEncodePath(L)));return M.setParams(N).signWithOauth(this.oauth)};J.prototype.revertFile=function(K,N,M){var L;L=new f.Xhr("POST",""+this.urls.restore+"/"+(this.urlEncodePath(K)));L.setParams({rev:N}).signWithOauth(this.oauth);return this.dispatchXhr(L,function(O,P){if(M){return M(O,f.Stat.parse(P))}})};J.prototype.restore=function(K,M,L){return this.revertFile(K,M,L)};J.prototype.findByName=function(N,M,L,Q){var K,P,O;if((!Q)&&(typeof L==="function")){Q=L;L=null}P={query:M};K=false;if(L){if(L.limit!=null){P.file_limit=L.limit}if(L.removed||L.deleted){P.include_deleted=true}if(L.httpCache){K=true}}O=new f.Xhr("GET",""+this.urls.search+"/"+(this.urlEncodePath(N)));O.setParams(P).signWithOauth(this.oauth,K);return this.dispatchXhr(O,function(R,U){var T,S;if(U){S=(function(){var X,W,V;V=[];for(X=0,W=U.length;X<W;X++){T=U[X];V.push(f.Stat.parse(T))}return V})()}else{S=void 0}return Q(R,S)})};J.prototype.search=function(M,L,K,N){return this.findByName(M,L,K,N)};J.prototype.makeCopyReference=function(K,M){var L;L=new f.Xhr("GET",""+this.urls.copyRef+"/"+(this.urlEncodePath(K)));L.signWithOauth(this.oauth);return this.dispatchXhr(L,function(O,N){return M(O,f.CopyReference.parse(N))})};J.prototype.copyRef=function(K,L){return this.makeCopyReference(K,L)};J.prototype.pullChanges=function(M,N){var L,K;if((!N)&&(typeof M==="function")){N=M;M=null}if(M){if(M.cursorTag){L={cursor:M.cursorTag}}else{L={cursor:M}}}else{L={}}K=new f.Xhr("POST",this.urls.delta);K.setParams(L).signWithOauth(this.oauth);return this.dispatchXhr(K,function(P,O){return N(P,f.PulledChanges.parse(O))})};J.prototype.delta=function(K,L){return this.pullChanges(K,L)};J.prototype.mkdir=function(K,M){var L;L=new f.Xhr("POST",this.urls.fileopsCreateFolder);L.setParams({root:this.fileRoot,path:this.normalizePath(K)}).signWithOauth(this.oauth);return this.dispatchXhr(L,function(N,O){if(M){return M(N,f.Stat.parse(O))}})};J.prototype.remove=function(K,M){var L;L=new f.Xhr("POST",this.urls.fileopsDelete);L.setParams({root:this.fileRoot,path:this.normalizePath(K)}).signWithOauth(this.oauth);return this.dispatchXhr(L,function(N,O){if(M){return M(N,f.Stat.parse(O))}})};J.prototype.unlink=function(K,L){return this.remove(K,L)};J.prototype["delete"]=function(K,L){return this.remove(K,L)};J.prototype.copy=function(P,L,O){var K,N,M;if((!O)&&(typeof K==="function")){O=K;K=null}N={root:this.fileRoot,to_path:this.normalizePath(L)};if(P instanceof f.CopyReference){N.from_copy_ref=P.tag}else{N.from_path=this.normalizePath(P)}M=new f.Xhr("POST",this.urls.fileopsCopy);M.setParams(N).signWithOauth(this.oauth);return this.dispatchXhr(M,function(Q,R){if(O){return O(Q,f.Stat.parse(R))}})};J.prototype.move=function(N,L,O){var K,M;if((!O)&&(typeof K==="function")){O=K;K=null}M=new f.Xhr("POST",this.urls.fileopsMove);M.setParams({root:this.fileRoot,from_path:this.normalizePath(N),to_path:this.normalizePath(L)}).signWithOauth(this.oauth);return this.dispatchXhr(M,function(P,Q){if(O){return O(P,f.Stat.parse(Q))}})};J.prototype.reset=function(){var K;this.uid=null;this.oauth.setToken(null,"");K=this.authState;this.authState=w.RESET;if(K!==this.authState){this.onAuthStateChange.dispatch(this)}this.authError=null;this._credentials=null;return this};J.prototype.setCredentials=function(L){var K;K=this.authState;this.oauth.reset(L);this.uid=L.uid||null;if(L.authState){this.authState=L.authState}else{if(L.token){this.authState=w.DONE}else{this.authState=w.RESET}}this.authError=null;this._credentials=null;if(K!==this.authState){this.onAuthStateChange.dispatch(this)}return this};J.prototype.appHash=function(){return this.oauth.appHash()};J.prototype.setupUrls=function(){this.fileRoot=this.sandbox?"sandbox":"dropbox";return this.urls={requestToken:""+this.apiServer+"/1/oauth/request_token",authorize:""+this.authServer+"/1/oauth/authorize",accessToken:""+this.apiServer+"/1/oauth/access_token",signOut:""+this.apiServer+"/1/unlink_access_token",accountInfo:""+this.apiServer+"/1/account/info",getFile:""+this.fileServer+"/1/files/"+this.fileRoot,postFile:""+this.fileServer+"/1/files/"+this.fileRoot,putFile:""+this.fileServer+"/1/files_put/"+this.fileRoot,metadata:""+this.apiServer+"/1/metadata/"+this.fileRoot,delta:""+this.apiServer+"/1/delta",revisions:""+this.apiServer+"/1/revisions/"+this.fileRoot,restore:""+this.apiServer+"/1/restore/"+this.fileRoot,search:""+this.apiServer+"/1/search/"+this.fileRoot,shares:""+this.apiServer+"/1/shares/"+this.fileRoot,media:""+this.apiServer+"/1/media/"+this.fileRoot,copyRef:""+this.apiServer+"/1/copy_ref/"+this.fileRoot,thumbnails:""+this.fileServer+"/1/thumbnails/"+this.fileRoot,chunkedUpload:""+this.fileServer+"/1/chunked_upload",commitChunkedUpload:""+this.fileServer+"/1/commit_chunked_upload/"+this.fileRoot,fileopsCopy:""+this.apiServer+"/1/fileops/copy",fileopsCreateFolder:""+this.apiServer+"/1/fileops/create_folder",fileopsDelete:""+this.apiServer+"/1/fileops/delete",fileopsMove:""+this.apiServer+"/1/fileops/move"}};J.prototype.authState=null;J.ERROR=0;J.RESET=1;J.REQUEST=2;J.AUTHORIZED=3;J.DONE=4;J.SIGNED_OFF=5;J.prototype.urlEncodePath=function(K){return f.Xhr.urlEncodeValue(this.normalizePath(K)).replace(/%2F/gi,"/")};J.prototype.normalizePath=function(L){var K;if(L.substring(0,1)==="/"){K=1;while(L.substring(K,K+1)==="/"){K+=1}return L.substring(K)}else{return L}};J.prototype.requestToken=function(L){var K;K=new f.Xhr("POST",this.urls.requestToken).signWithOauth(this.oauth);return this.dispatchXhr(K,L)};J.prototype.authorizeUrl=function(K){var M,L;M=this.driver.url(K);if(M===null){L={oauth_token:K}}else{L={oauth_token:K,oauth_callback:M}}return(""+this.urls.authorize+"?")+f.Xhr.urlEncode(L)};J.prototype.getAccessToken=function(L){var K;K=new f.Xhr("POST",this.urls.accessToken).signWithOauth(this.oauth);return this.dispatchXhr(K,L)};J.prototype.dispatchXhr=function(L,M){var K;L.setCallback(M);L.onError=this.xhrOnErrorHandler;L.prepare();K=L.xhr;if(this.onXhr.dispatch(L)){L.send()}return K};J.prototype.handleXhrError=function(K,M){var L=this;if(K.status===f.ApiError.INVALID_TOKEN&&this.authState===w.DONE){this.authError=K;this.authState=w.ERROR;this.onAuthStateChange.dispatch(this);if(this.driver&&this.driver.onAuthStateChange){this.driver.onAuthStateChange(this,function(){L.onError.dispatch(K);return M(K)});return null}}this.onError.dispatch(K);M(K);return null};J.prototype.defaultApiServer=function(){return"https://api.dropbox.com"};J.prototype.defaultAuthServer=function(){return this.apiServer.replace("api.","www.")};J.prototype.defaultFileServer=function(){return this.apiServer.replace("api.","api-content.")};J.prototype.defaultDownloadServer=function(){return this.apiServer.replace("api.","dl.")};J.prototype.computeCredentials=function(){var K;K={key:this.oauth.key,sandbox:this.sandbox};if(this.oauth.secret){K.secret=this.oauth.secret}if(this.oauth.token){K.token=this.oauth.token;K.tokenSecret=this.oauth.tokenSecret}if(this.uid){K.uid=this.uid}if(this.authState!==w.ERROR&&this.authState!==w.RESET&&this.authState!==w.DONE&&this.authState!==w.SIGNED_OFF){K.authState=this.authState}if(this.apiServer!==this.defaultApiServer()){K.server=this.apiServer}if(this.authServer!==this.defaultAuthServer()){K.authServer=this.authServer}if(this.fileServer!==this.defaultFileServer()){K.fileServer=this.fileServer}if(this.downloadServer!==this.defaultDownloadServer()){K.downloadServer=this.downloadServer}return this._credentials=K};return J})();w=f.Client;f.Drivers.BrowserBase=(function(){function J(K){this.rememberUser=(K!=null?K.rememberUser:void 0)||false;this.useQuery=(K!=null?K.useQuery:void 0)||false;this.scope=(K!=null?K.scope:void 0)||"default";this.storageKey=null;this.dbTokenRe=new RegExp("(#|\\?|&)dboauth_token=([^&#]+)(&|#|$)");this.rejectedRe=new RegExp("(#|\\?|&)not_approved=true(&|#|$)");this.tokenRe=new RegExp("(#|\\?|&)oauth_token=([^&#]+)(&|#|$)")}J.prototype.onAuthStateChange=function(K,M){var L=this;this.setStorageKey(K);switch(K.authState){case w.RESET:return this.loadCredentials(function(N){if(!N){return M()}if(N.authState){K.setCredentials(N);return M()}if(!L.rememberUser){return L.forgetCredentials(M)}K.setCredentials(N);return K.getUserInfo(function(O){if(O){K.reset();return L.forgetCredentials(M)}else{return M()}})});case w.REQUEST:return this.storeCredentials(K.credentials(),M);case w.DONE:if(this.rememberUser){return this.storeCredentials(K.credentials(),M)}return this.forgetCredentials(M);case w.SIGNED_OFF:return this.forgetCredentials(M);case w.ERROR:return this.forgetCredentials(M);default:M();return this}};J.prototype.setStorageKey=function(K){this.storageKey="dropbox-auth:"+this.scope+":"+(K.appHash());return this};J.prototype.storeCredentials=function(K,L){localStorage.setItem(this.storageKey,JSON.stringify(K));L();return this};J.prototype.loadCredentials=function(N){var K,L;L=localStorage.getItem(this.storageKey);if(!L){N(null);return this}try{N(JSON.parse(L))}catch(M){K=M;N(null)}return this};J.prototype.forgetCredentials=function(K){localStorage.removeItem(this.storageKey);K();return this};J.prototype.computeUrl=function(N){var L,K,O,M;M="_dropboxjs_scope="+(encodeURIComponent(this.scope))+"&dboauth_token=";K=N;if(K.indexOf("#")===-1){L=null}else{O=K.split("#",2);K=O[0];L=O[1]}if(this.useQuery){if(K.indexOf("?")===-1){K+="?"+M}else{K+="&"+M}if(L){return[K,"#"+L]}else{return[K,""]}}else{return[K+"#?"+M,""]}};J.prototype.locationToken=function(M){var K,L,N;K=M||f.Drivers.BrowserBase.currentLocation();N="_dropboxjs_scope="+(encodeURIComponent(this.scope))+"&";if((typeof K.indexOf==="function"?K.indexOf(N):void 0)===-1){return null}if(this.rejectedRe.test(K)){L=this.dbTokenRe.exec(K);if(L){return decodeURIComponent(L[2])}else{return null}}L=this.tokenRe.exec(K);if(L){return decodeURIComponent(L[2])}return null};J.currentLocation=function(){return window.location.href};return J})();f.Drivers.Redirect=(function(K){E(J,K);function J(L){var M;J.__super__.constructor.call(this,L);M=this.computeUrl(f.Drivers.BrowserBase.currentLocation()),this.receiverUrl1=M[0],this.receiverUrl2=M[1]}J.prototype.onAuthStateChange=function(L,O){var N,M=this;N=(function(){return function(){return J.__super__.onAuthStateChange.call(M,L,O)}})();this.setStorageKey(L);if(L.authState===w.RESET){return this.loadCredentials(function(P){if(P&&P.authState){if(P.token===M.locationToken()&&P.authState===w.REQUEST){P.authState=w.AUTHORIZED;return M.storeCredentials(P,N)}else{return M.forgetCredentials(N)}}return N()})}else{return N()}};J.prototype.url=function(L){return this.receiverUrl1+encodeURIComponent(L)+this.receiverUrl2};J.prototype.doAuthorize=function(L){return window.location.assign(L)};return J})(f.Drivers.BrowserBase);f.Drivers.Popup=(function(J){E(K,J);function K(L){var M;K.__super__.constructor.call(this,L);M=this.computeUrl(this.baseUrl(L)),this.receiverUrl1=M[0],this.receiverUrl2=M[1]}K.prototype.onAuthStateChange=function(L,O){var N,M=this;N=(function(){return function(){return K.__super__.onAuthStateChange.call(M,L,O)}})();this.setStorageKey(L);if(L.authState===w.RESET){return this.loadCredentials(function(P){if(P&&P.authState){return M.forgetCredentials(N)}return N()})}else{return N()}};K.prototype.doAuthorize=function(L,M,N,O){this.listenForMessage(M,O);return this.openWindow(L)};K.prototype.url=function(L){return this.receiverUrl1+encodeURIComponent(L)+this.receiverUrl2};K.prototype.baseUrl=function(M){var L;if(M){if(M.receiverUrl){return M.receiverUrl}else{if(M.receiverFile){L=f.Drivers.BrowserBase.currentLocation().split("/");L[L.length-1]=M.receiverFile;return L.join("/")}}}return f.Drivers.BrowserBase.currentLocation()};K.prototype.openWindow=function(L){return window.open(L,"_dropboxOauthSigninWindow",this.popupWindowSpec(980,700))};K.prototype.popupWindowSpec=function(S,R){var V,W,U,L,M,T,Q,P,O,N;M=(Q=window.screenX)!=null?Q:window.screenLeft;T=(P=window.screenY)!=null?P:window.screenTop;L=(O=window.outerWidth)!=null?O:document.documentElement.clientWidth;V=(N=window.outerHeight)!=null?N:document.documentElement.clientHeight;W=Math.round(M+(L-S)/2);U=Math.round(T+(V-R)/2.5);if(W<M){W=M}if(U<T){U=T}return("width="+S+",height="+R+",")+("left="+W+",top="+U)+"dialog=yes,dependent=yes,scrollbars=yes,location=yes"};K.prototype.listenForMessage=function(L,O){var M,N=this;M=function(P){var Q;if(P.data){Q=P.data}else{Q=P}if(N.locationToken(Q)===L){L=null;window.removeEventListener("message",M);f.Drivers.Popup.onMessage.removeListener(M);return O()}};window.addEventListener("message",M,false);return f.Drivers.Popup.onMessage.addListener(M)};K.oauthReceiver=function(){return window.addEventListener("load",function(){var O,M,L;L=window.opener;if(window.parent!==window.top){L||(L=window.parent)}if(L){try{L.postMessage(window.location.href,"*")}catch(N){M=N}try{L.Dropbox.Drivers.Popup.onMessage.dispatch(window.location.href)}catch(N){O=N}}return window.close()})};K.onMessage=new f.EventSource;return K})(f.Drivers.BrowserBase);r=null;p=null;if(typeof chrome!=="undefined"&&chrome!==null){if(chrome.runtime){if(chrome.runtime.onMessage){r=chrome.runtime.onMessage}if(chrome.runtime.sendMessage){p=function(J){return chrome.runtime.sendMessage(J)}}}if(chrome.extension){if(chrome.extension.onMessage){r||(r=chrome.extension.onMessage)}if(chrome.extension.sendMessage){p||(p=function(J){return chrome.extension.sendMessage(J)})}}if(!r){(function(){var K,J;J=function(L){if(L.Dropbox){f.Drivers.Chrome.prototype.onMessage=L.Dropbox.Drivers.Chrome.onMessage;return f.Drivers.Chrome.prototype.sendMessage=L.Dropbox.Drivers.Chrome.sendMessage}else{L.Dropbox=f;f.Drivers.Chrome.prototype.onMessage=new f.EventSource;return f.Drivers.Chrome.prototype.sendMessage=function(M){return f.Drivers.Chrome.prototype.onMessage.dispatch(M)}}};if(chrome.extension&&chrome.extension.getBackgroundPage){if(K=chrome.extension.getBackgroundPage()){return J(K)}}if(chrome.runtime&&chrome.runtime.getBackgroundPage){return chrome.runtime.getBackgroundPage(function(L){return J(L)})}})()}}f.Drivers.Chrome=(function(J){E(K,J);K.prototype.onMessage=r;K.prototype.sendMessage=p;K.prototype.expandUrl=function(L){if(chrome.runtime&&chrome.runtime.getURL){return chrome.runtime.getURL(L)}if(chrome.extension&&chrome.extension.getURL){return chrome.extension.getURL(L)}return L};function K(L){var N,M;K.__super__.constructor.call(this,L);N=(L&&L.receiverPath)||"chrome_oauth_receiver.html";this.rememberUser=true;this.useQuery=true;M=this.computeUrl(this.expandUrl(N)),this.receiverUrl=M[0],this.receiverUrl2=M[1];this.storageKey="dropbox_js_"+this.scope+"_credentials"}K.prototype.onAuthStateChange=function(L,N){var M=this;switch(L.authState){case f.Client.RESET:return this.loadCredentials(function(O){if(O){if(O.authState){return M.forgetCredentials(N)}L.setCredentials(O)}return N()});case f.Client.DONE:return this.storeCredentials(L.credentials(),N);case f.Client.SIGNED_OFF:return this.forgetCredentials(N);case f.Client.ERROR:return this.forgetCredentials(N);default:return N()}};K.prototype.doAuthorize=function(O,M,R,T){var S,P,N,L,Q=this;if((P=chrome.identity)!=null?P.launchWebAuthFlow:void 0){return chrome.identity.launchWebAuthFlow({url:O,interactive:true},function(U){if(Q.locationToken(U)===M){return T()}})}else{if((N=chrome.experimental)!=null?(L=N.identity)!=null?L.launchWebAuthFlow:void 0:void 0){return chrome.experimental.identity.launchWebAuthFlow({url:O,interactive:true},function(U){if(Q.locationToken(U)===M){return T()}})}else{S={handle:null};this.listenForMessage(M,S,T);return this.openWindow(O,function(U){return S.handle=U})}}};K.prototype.openWindow=function(L,M){if(chrome.tabs&&chrome.tabs.create){chrome.tabs.create({url:L,active:true,pinned:false},function(N){return M(N)});return this}return this};K.prototype.closeWindow=function(L){if(chrome.tabs&&chrome.tabs.remove&&L.id){chrome.tabs.remove(L.id);return this}if(chrome.app&&chrome.app.window&&L.close){L.close();return this}return this};K.prototype.url=function(L){return this.receiverUrl+encodeURIComponent(L)};K.prototype.listenForMessage=function(L,M,P){var N,O=this;N=function(R,Q){if(Q&&Q.tab){if(Q.tab.url.substring(0,O.receiverUrl.length)!==O.receiverUrl){return}}if(!R.dropbox_oauth_receiver_href){return}if(O.locationToken(R.dropbox_oauth_receiver_href)===L){if(M.handle){O.closeWindow(M.handle)}O.onMessage.removeListener(N);return P()}};return this.onMessage.addListener(N)};K.prototype.storeCredentials=function(M,N){var L;L={};L[this.storageKey]=M;chrome.storage.local.set(L,N);return this};K.prototype.loadCredentials=function(M){var L=this;chrome.storage.local.get(this.storageKey,function(N){return M(N[L.storageKey]||null)});return this};K.prototype.forgetCredentials=function(L){chrome.storage.local.remove(this.storageKey,L);return this};K.oauthReceiver=function(){return window.addEventListener("load",function(){var L;L=new f.Drivers.Chrome();L.sendMessage({dropbox_oauth_receiver_href:window.location.href});if(window.close){return window.close()}})};return K})(f.Drivers.BrowserBase);f.Drivers.Cordova=(function(K){E(J,K);function J(L){this.rememberUser=(L!=null?L.rememberUser:void 0)||false;this.scope=(L!=null?L.scope:void 0)||"default"}J.prototype.doAuthorize=function(N,P,Q,S){var O,M,R,L;M=window.open(N,"_blank","location=yes");L=false;O=/^[^/]*\/\/[^/]*\//.exec(N)[0];R=function(T){if(T.url===N&&L===false){L=true;return}if(T.url&&T.url.substring(0,O.length)!==O){L=false;return}if(T.type==="exit"||L){M.removeEventListener("loadstop",R);M.removeEventListener("exit",R);if(T.type!=="exit"){M.close()}return S()}};M.addEventListener("loadstop",R);return M.addEventListener("exit",R)};J.prototype.url=function(){return null};J.prototype.onAuthStateChange=function(L,O){var N,M=this;N=(function(){return function(){return J.__super__.onAuthStateChange.call(M,L,O)}})();this.setStorageKey(L);if(L.authState===w.RESET){return this.loadCredentials(function(P){if(P&&P.authState){return M.forgetCredentials(N)}else{return N()}})}else{return N()}};return J})(f.Drivers.BrowserBase);f.Drivers.NodeServer=(function(){function J(K){this.port=(K!=null?K.port:void 0)||8912;this.faviconFile=(K!=null?K.favicon:void 0)||null;this.fs=require("fs");this.http=require("http");this.open=require("open");this.callbacks={};this.nodeUrl=require("url");this.createApp()}J.prototype.url=function(K){return("http://localhost:"+this.port+"/oauth_callback?dboauth_token=")+encodeURIComponent(K)};J.prototype.doAuthorize=function(K,L,M,N){this.callbacks[L]=N;return this.openBrowser(K)};J.prototype.openBrowser=function(K){if(!K.match(/^https?:\/\//)){throw new Error("Not a http/https URL: "+K)}if("BROWSER" in process.env){return this.open(K,process.env.BROWSER)}else{return this.open(K)}};J.prototype.createApp=function(){var K=this;this.app=this.http.createServer(function(M,L){return K.doRequest(M,L)});return this.app.listen(this.port)};J.prototype.closeServer=function(){return this.app.close()};J.prototype.doRequest=function(N,K){var P,O,M,L,Q=this;L=this.nodeUrl.parse(N.url,true);if(L.pathname==="/oauth_callback"){if(L.query.not_approved==="true"){O=true;M=L.query.dboauth_token}else{O=false;M=L.query.oauth_token}if(this.callbacks[M]){this.callbacks[M](O);delete this.callbacks[M]}}P="";N.on("data",function(R){return P+=R});return N.on("end",function(){if(Q.faviconFile&&(L.pathname==="/favicon.ico")){return Q.sendFavicon(K)}else{return Q.closeBrowser(K)}})};J.prototype.closeBrowser=function(K){var L;L='<!doctype html>\n<script type="text/javascript">window.close();<\/script>\n<p>Please close this window.</p>';K.writeHead(200,{"Content-Length":L.length,"Content-Type":"text/html"});K.write(L);return K.end()};J.prototype.sendFavicon=function(K){return this.fs.readFile(this.faviconFile,function(L,M){K.writeHead(200,{"Content-Length":M.length,"Content-Type":"image/x-icon"});K.write(M);return K.end()})};return J})();B=function(J,K){return A(e(d(J),d(K),J.length,K.length))};H=function(J){return A(t(d(J),J.length))};if(typeof require!=="undefined"){try{o=require("crypto");if(o.createHmac&&o.createHash){B=function(J,K){var L;L=o.createHmac("sha1",K);L.update(J);return L.digest("base64")};H=function(J){var K;K=o.createHash("sha1");K.update(J);return K.digest("base64")}}}catch(h){C=h}}f.Util.hmac=B;f.Util.sha1=H;e=function(L,N,P,K){var Q,M,J,O;if(N.length>16){N=t(N,K)}J=(function(){var S,R;R=[];for(M=S=0;S<16;M=++S){R.push(N[M]^909522486)}return R})();O=(function(){var S,R;R=[];for(M=S=0;S<16;M=++S){R.push(N[M]^1549556828)}return R})();Q=t(J.concat(L),64+P);return t(O.concat(Q),64+20)};t=function(J,M){var aa,ac,Z,P,Y,S,X,K,V,Q,O,U,T,ab,W,N,R,L;J[M>>2]|=1<<(31-((M&3)<<3));J[(((M+8)>>6)<<4)+15]=M<<3;N=Array(80);aa=1732584193;Z=-271733879;Y=-1732584194;X=271733878;V=-1009589776;U=0;W=J.length;while(U<W){ac=aa;P=Z;S=Y;K=X;Q=V;for(T=L=0;L<80;T=++L){if(T<16){N[T]=J[U+T]}else{N[T]=n(N[T-3]^N[T-8]^N[T-14]^N[T-16],1)}if(T<20){O=(Z&Y)|((~Z)&X);ab=1518500249}else{if(T<40){O=Z^Y^X;ab=1859775393}else{if(T<60){O=(Z&Y)|(Z&X)|(Y&X);ab=-1894007588}else{O=Z^Y^X;ab=-899497514}}}R=l(l(n(aa,5),O),l(l(V,N[T]),ab));V=X;X=Y;Y=n(Z,30);Z=aa;aa=R}aa=l(aa,ac);Z=l(Z,P);Y=l(Y,S);X=l(X,K);V=l(V,Q);U+=16}return[aa,Z,Y,X,V]};n=function(K,J){return(K<<J)|(K>>>(32-J))};l=function(L,K){var M,J;J=(L&65535)+(K&65535);M=(L>>16)+(K>>16)+(J>>16);return(M<<16)|(J&65535)};A=function(O){var M,N,J,K,L;K="";M=0;J=O.length*4;while(M<J){N=M;L=((O[N>>2]>>((3-(N&3))<<3))&255)<<16;N+=1;L|=((O[N>>2]>>((3-(N&3))<<3))&255)<<8;N+=1;L|=(O[N>>2]>>((3-(N&3))<<3))&255;K+=a[(L>>18)&63];K+=a[(L>>12)&63];M+=1;if(M>=J){K+="="}else{K+=a[(L>>6)&63]}M+=1;if(M>=J){K+="="}else{K+=a[L&63]}M+=1}return K};a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";d=function(K){var O,L,J,N,M;O=[];J=255;for(L=N=0,M=K.length;0<=M?N<M:N>M;L=0<=M?++N:--N){O[L>>2]|=(K.charCodeAt(L)&J)<<((3-(L&3))<<3)}return O};f.Oauth=(function(){function J(K){this.key=this.k=null;this.secret=this.s=null;this.token=null;this.tokenSecret=null;this._appHash=null;this.reset(K)}J.prototype.reset=function(M){var L,N,K,O;if(M.secret){this.k=this.key=M.key;this.s=this.secret=M.secret;this._appHash=null}else{if(M.key){this.key=M.key;this.secret=null;K=j(F(this.key).split("|",2)[1]);O=K.split("?",2),L=O[0],N=O[1];this.k=decodeURIComponent(L);this.s=decodeURIComponent(N);this._appHash=null}else{if(!this.k){throw new Error("No API key supplied")}}}if(M.token){return this.setToken(M.token,M.tokenSecret)}else{return this.setToken(null,"")}};J.prototype.setToken=function(K,L){if(K&&(!L)){throw new Error("No secret supplied with the user token")}this.token=K;this.tokenSecret=L||"";this.hmacKey=f.Xhr.urlEncodeValue(this.s)+"&"+f.Xhr.urlEncodeValue(L);return null};J.prototype.authHeader=function(K,L,N){var Q,P,M,S,O,R;this.addAuthParams(K,L,N);P=[];for(M in N){S=N[M];if(M.substring(0,6)==="oauth_"){P.push(M)}}P.sort();Q=[];for(O=0,R=P.length;O<R;O++){M=P[O];Q.push(f.Xhr.urlEncodeValue(M)+'="'+f.Xhr.urlEncodeValue(N[M])+'"');delete N[M]}return"OAuth "+Q.join(",")};J.prototype.addAuthParams=function(M,K,L){this.boilerplateParams(L);L.oauth_signature=this.signature(M,K,L);return L};J.prototype.boilerplateParams=function(K){K.oauth_consumer_key=this.k;K.oauth_nonce=f.Oauth.nonce();K.oauth_signature_method="HMAC-SHA1";if(this.token){K.oauth_token=this.token}K.oauth_timestamp=Math.floor(Date.now()/1000);K.oauth_version="1.0";return K};J.nonce=function(){return Math.random().toString(36)};J.prototype.signature=function(N,L,M){var K;K=N.toUpperCase()+"&"+f.Xhr.urlEncodeValue(L)+"&"+f.Xhr.urlEncodeValue(f.Xhr.urlEncode(M));return B(K,this.hmacKey)};J.prototype.appHash=function(){if(this._appHash){return this._appHash}return this._appHash=H(this.k).replace(/\=/g,"")};return J})();if(Date.now==null){Date.now=function(){return(new Date()).getTime()}}F=function(U,J){var Q,N,W,V,T,S,R,O,M,P,L,K;if(J){J=[encodeURIComponent(U),encodeURIComponent(J)].join("?");U=(function(){var Z,Y,X;X=[];for(Q=Z=0,Y=U.length/2;0<=Y?Z<Y:Z>Y;Q=0<=Y?++Z:--Z){X.push(((U.charCodeAt(Q*2)&15)*16)+(U.charCodeAt(Q*2+1)&15))}return X})()}else{P=U.split("|",2),U=P[0],J=P[1];U=j(U);U=(function(){var Z,X,Y;Y=[];for(Q=Z=0,X=U.length;0<=X?Z<X:Z>X;Q=0<=X?++Z:--Z){Y.push(U.charCodeAt(Q))}return Y})();J=j(J)}V=(function(){K=[];for(O=0;O<256;O++){K.push(O)}return K}).apply(this);S=0;for(T=M=0;M<256;T=++M){S=(S+V[Q]+U[T%U.length])%256;L=[V[S],V[T]],V[T]=L[0],V[S]=L[1]}T=S=0;W=(function(){var Y,aa,Z,X;X=[];for(R=Y=0,aa=J.length;0<=aa?Y<aa:Y>aa;R=0<=aa?++Y:--Y){T=(T+1)%256;S=(S+V[T])%256;Z=[V[S],V[T]],V[T]=Z[0],V[S]=Z[1];N=V[(V[T]+V[S])%256];X.push(String.fromCharCode((N^J.charCodeAt(R))%256))}return X})();U=(function(){var Y,Z,X;X=[];for(Q=Y=0,Z=U.length;0<=Z?Y<Z:Y>Z;Q=0<=Z?++Y:--Y){X.push(String.fromCharCode(U[Q]))}return X})();return[m(U.join("")),m(W.join(""))].join("|")};f.Util.encodeKey=F;f.PulledChanges=(function(){J.parse=function(K){if(K&&typeof K==="object"){return new f.PulledChanges(K)}else{return K}};J.prototype.blankSlate=void 0;J.prototype.cursorTag=void 0;J.prototype.changes=void 0;J.prototype.shouldPullAgain=void 0;J.prototype.shouldBackOff=void 0;J.prototype.cursor=function(){return this.cursorTag};function J(K){var L;this.blankSlate=K.reset||false;this.cursorTag=K.cursor;this.shouldPullAgain=K.has_more;this.shouldBackOff=!this.shouldPullAgain;if(K.cursor&&K.cursor.length){this.changes=(function(){var P,N,O,M;O=K.entries;M=[];for(P=0,N=O.length;P<N;P++){L=O[P];M.push(f.PullChange.parse(L))}return M})()}else{this.changes=[]}}return J})();f.PullChange=(function(){J.parse=function(K){if(K&&typeof K==="object"){return new f.PullChange(K)}else{return K}};J.prototype.path=void 0;J.prototype.wasRemoved=void 0;J.prototype.stat=void 0;function J(K){this.path=K[0];this.stat=f.Stat.parse(K[1]);if(this.stat){this.wasRemoved=false}else{this.stat=null;this.wasRemoved=true}}return J})();f.RangeInfo=(function(){J.parse=function(K){if(typeof K==="string"){return new f.RangeInfo(K)}else{return K}};J.prototype.start=null;J.prototype.size=null;J.prototype.end=null;function J(L){var K;if(K=/^bytes (\d*)-(\d*)\/(.*)$/.exec(L)){this.start=parseInt(K[1]);this.end=parseInt(K[2]);if(K[3]==="*"){this.size=null}else{this.size=parseInt(K[3])}}else{this.start=0;this.end=0;this.size=null}}return J})();f.PublicUrl=(function(){J.parse=function(K,L){if(K&&typeof K==="object"){return new f.PublicUrl(K,L)}else{return K}};J.prototype.url=null;J.prototype.expiresAt=null;J.prototype.isDirect=null;J.prototype.isPreview=null;J.prototype.json=function(){return this._json||(this._json={url:this.url,expires:this.expiresAt.toString(),direct:this.isDirect})};function J(K,L){this.url=K.url;this.expiresAt=new Date(Date.parse(K.expires));if(L===true){this.isDirect=true}else{if(L===false){this.isDirect=false}else{if("direct" in K){this.isDirect=K.direct}else{this.isDirect=Date.now()-this.expiresAt<=86400000}}}this.isPreview=!this.isDirect;this._json=null}return J})();f.CopyReference=(function(){J.parse=function(K){if(K&&(typeof K==="object"||typeof K==="string")){return new f.CopyReference(K)}else{return K}};J.prototype.tag=null;J.prototype.expiresAt=null;J.prototype.json=function(){return this._json||(this._json={copy_ref:this.tag,expires:this.expiresAt.toString()})};function J(K){if(typeof K==="object"){this.tag=K.copy_ref;this.expiresAt=new Date(Date.parse(K.expires));this._json=K}else{this.tag=K;this.expiresAt=new Date(Math.ceil(Date.now()/1000)*1000);this._json=null}}return J})();f.Stat=(function(){J.parse=function(K){if(K&&typeof K==="object"){return new f.Stat(K)}else{return K}};J.prototype.path=null;J.prototype.name=null;J.prototype.inAppFolder=null;J.prototype.isFolder=null;J.prototype.isFile=null;J.prototype.isRemoved=null;J.prototype.typeIcon=null;J.prototype.versionTag=null;J.prototype.mimeType=null;J.prototype.size=null;J.prototype.humanSize=null;J.prototype.hasThumbnail=null;J.prototype.modifiedAt=null;J.prototype.clientModifiedAt=null;J.prototype.json=function(){return this._json};function J(L){var O,N,M,K;this._json=L;this.path=L.path;if(this.path.substring(0,1)!=="/"){this.path="/"+this.path}O=this.path.length-1;if(O>=0&&this.path.substring(O)==="/"){this.path=this.path.substring(0,O)}N=this.path.lastIndexOf("/");this.name=this.path.substring(N+1);this.isFolder=L.is_dir||false;this.isFile=!this.isFolder;this.isRemoved=L.is_deleted||false;this.typeIcon=L.icon;if((M=L.modified)!=null?M.length:void 0){this.modifiedAt=new Date(Date.parse(L.modified))}else{this.modifiedAt=null}if((K=L.client_mtime)!=null?K.length:void 0){this.clientModifiedAt=new Date(Date.parse(L.client_mtime))}else{this.clientModifiedAt=null}switch(L.root){case"dropbox":this.inAppFolder=false;break;case"app_folder":this.inAppFolder=true;break;default:this.inAppFolder=null}this.size=L.bytes||0;this.humanSize=L.size||"";this.hasThumbnail=L.thumb_exists||false;if(this.isFolder){this.versionTag=L.hash;this.mimeType=L.mime_type||"inode/directory"}else{this.versionTag=L.rev;this.mimeType=L.mime_type||"application/octet-stream"}}return J})();f.UploadCursor=(function(){J.parse=function(K){if(K&&(typeof K==="object"||typeof K==="string")){return new f.UploadCursor(K)}else{return K}};J.prototype.tag=null;J.prototype.offset=null;J.prototype.expiresAt=null;J.prototype.json=function(){return this._json||(this._json={upload_id:this.tag,offset:this.offset,expires:this.expiresAt.toString()})};function J(K){this.replace(K)}J.prototype.replace=function(K){if(typeof K==="object"){this.tag=K.upload_id||null;this.offset=K.offset||0;this.expiresAt=new Date(Date.parse(K.expires)||Date.now());this._json=K}else{this.tag=K||null;this.offset=0;this.expiresAt=new Date(Math.floor(Date.now()/1000)*1000);this._json=null}return this};return J})();f.UserInfo=(function(){J.parse=function(K){if(K&&typeof K==="object"){return new f.UserInfo(K)}else{return K}};J.prototype.name=null;J.prototype.email=null;J.prototype.countryCode=null;J.prototype.uid=null;J.prototype.referralUrl=null;J.prototype.publicAppUrl=null;J.prototype.quota=null;J.prototype.usedQuota=null;J.prototype.privateBytes=null;J.prototype.sharedBytes=null;J.prototype.json=function(){return this._json};function J(K){var L;this._json=K;this.name=K.display_name;this.email=K.email;this.countryCode=K.country||null;this.uid=K.uid.toString();if(K.public_app_url){this.publicAppUrl=K.public_app_url;L=this.publicAppUrl.length-1;if(L>=0&&this.publicAppUrl.substring(L)==="/"){this.publicAppUrl=this.publicAppUrl.substring(0,L)}}else{this.publicAppUrl=null}this.referralUrl=K.referral_link;this.quota=K.quota_info.quota;this.privateBytes=K.quota_info.normal||0;this.sharedBytes=K.quota_info.shared||0;this.usedQuota=this.privateBytes+this.sharedBytes}return J})();if(typeof XMLHttpRequest!=="undefined"&&(typeof window!=="undefined"||typeof self!=="undefined")&&typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"){if(typeof XDomainRequest!=="undefined"&&!("withCredentials" in new XMLHttpRequest())){g=XDomainRequest;D=true;G=false}else{g=XMLHttpRequest;D=false;G=typeof FormData!=="undefined"&&navigator.userAgent.indexOf("Firefox")===-1}y=true}else{g=require("xhr2");D=false;G=false;y=false}if(typeof Uint8Array==="undefined"){c=null;i=false;s=false}else{if(Object.getPrototypeOf){c=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array(0))).constructor}else{if(Object.__proto__){c=(new Uint8Array(0)).__proto__.__proto__.constructor}}if(typeof Blob==="undefined"){i=false;s=true}else{try{if((new Blob([new Uint8Array(2)])).size===2){i=true;s=true}else{s=false;i=(new Blob([new ArrayBuffer(2)])).size===2}}catch(h){k=h;s=false;i=false;if(typeof WebKitBlobBuilder!=="undefined"){if(navigator.userAgent.indexOf("Android")!==-1){G=false}}}if(c===Object){s=false}}}f.Xhr=(function(){J.Request=g;J.ieXdr=D;J.canSendForms=G;J.doesPreflight=y;J.ArrayBufferView=c;J.sendArrayBufferView=s;J.wrapBlob=i;function J(L,K){this.method=L;this.isGet=this.method==="GET";this.url=K;this.wantHeaders=false;this.headers={};this.params=null;this.body=null;this.preflight=!(this.isGet||(this.method==="POST"));this.signed=false;this.completed=false;this.responseType=null;this.callback=null;this.xhr=null;this.onError=null}J.prototype.xhr=null;J.prototype.onError=null;J.prototype.setParams=function(K){if(this.signed){throw new Error("setParams called after addOauthParams or addOauthHeader")}if(this.params){throw new Error("setParams cannot be called twice")}this.params=K;return this};J.prototype.setCallback=function(K){this.callback=K;return this};J.prototype.signWithOauth=function(L,K){if(f.Xhr.ieXdr){return this.addOauthParams(L)}else{if(this.preflight||!f.Xhr.doesPreflight){return this.addOauthHeader(L)}else{if(this.isGet&&K){return this.addOauthHeader(L)}else{return this.addOauthParams(L)}}}};J.prototype.addOauthParams=function(K){if(this.signed){throw new Error("Request already has an OAuth signature")}this.params||(this.params={});K.addAuthParams(this.method,this.url,this.params);this.signed=true;return this};J.prototype.addOauthHeader=function(K){if(this.signed){throw new Error("Request already has an OAuth signature")}this.params||(this.params={});this.signed=true;return this.setHeader("Authorization",K.authHeader(this.method,this.url,this.params))};J.prototype.setBody=function(K){if(this.isGet){throw new Error("setBody cannot be called on GET requests")}if(this.body!==null){throw new Error("Request already has a body")}if(typeof K==="string"){}else{if((typeof FormData!=="undefined")&&(K instanceof FormData)){}else{this.headers["Content-Type"]="application/octet-stream";this.preflight=true}}this.body=K;return this};J.prototype.setResponseType=function(K){this.responseType=K;return this};J.prototype.setHeader=function(M,L){var K;if(this.headers[M]){K=this.headers[M];throw new Error("HTTP header "+M+" already set to "+K)}if(M==="Content-Type"){throw new Error("Content-Type is automatically computed based on setBody")}this.preflight=true;this.headers[M]=L;return this};J.prototype.reportResponseHeaders=function(){return this.wantHeaders=true};J.prototype.setFileField=function(S,N,P,R){var K,L,O,M;if(this.body!==null){throw new Error("Request already has a body")}if(this.isGet){throw new Error("setFileField cannot be called on GET requests")}if(typeof P==="object"){if(typeof ArrayBuffer!=="undefined"){if(P instanceof ArrayBuffer){if(f.Xhr.sendArrayBufferView){P=new Uint8Array(P)}}else{if(!f.Xhr.sendArrayBufferView&&P.byteOffset===0&&P.buffer instanceof ArrayBuffer){P=P.buffer}}}R||(R="application/octet-stream");try{P=new Blob([P],{type:R})}catch(Q){k=Q;if(window.WebKitBlobBuilder){O=new WebKitBlobBuilder;O.append(P);if(K=O.getBlob(R)){P=K}}}if(typeof File!=="undefined"&&P instanceof File){P=new Blob([P],{type:P.type})}M=P instanceof Blob}else{M=false}if(M){this.body=new FormData();return this.body.append(S,P,N)}else{R||(R="application/octet-stream");L=this.multipartBoundary();this.headers["Content-Type"]="multipart/form-data; boundary="+L;return this.body=["--",L,"\r\n",'Content-Disposition: form-data; name="',S,'"; filename="',N,'"\r\n',"Content-Type: ",R,"\r\n","Content-Transfer-Encoding: binary\r\n\r\n",P,"\r\n","--",L,"--","\r\n"].join("")}};J.prototype.multipartBoundary=function(){return[Date.now().toString(36),Math.random().toString(36)].join("----")};J.prototype.paramsToUrl=function(){var K;if(this.params){K=f.Xhr.urlEncode(this.params);if(K.length!==0){this.url=[this.url,"?",K].join("")}this.params=null}return this};J.prototype.paramsToBody=function(){if(this.params){if(this.body!==null){throw new Error("Request already has a body")}if(this.isGet){throw new Error("paramsToBody cannot be called on GET requests")}this.headers["Content-Type"]="application/x-www-form-urlencoded";this.body=f.Xhr.urlEncode(this.params);this.params=null}return this};J.prototype.prepare=function(){var O,K,M,L,N=this;K=f.Xhr.ieXdr;if(this.isGet||this.body!==null||K){this.paramsToUrl();if(this.body!==null&&typeof this.body==="string"){this.headers["Content-Type"]="text/plain; charset=utf8"}}else{this.paramsToBody()}this.xhr=new f.Xhr.Request();if(K){this.xhr.onload=function(){return N.onXdrLoad()};this.xhr.onerror=function(){return N.onXdrError()};this.xhr.ontimeout=function(){return N.onXdrError()};this.xhr.onprogress=function(){}}else{this.xhr.onreadystatechange=function(){return N.onReadyStateChange()}}this.xhr.open(this.method,this.url,true);if(!K){L=this.headers;for(O in L){if(!q.call(L,O)){continue}M=L[O];this.xhr.setRequestHeader(O,M)}}if(this.responseType){if(this.responseType==="b"){if(this.xhr.overrideMimeType){this.xhr.overrideMimeType("text/plain; charset=x-user-defined")}}else{this.xhr.responseType=this.responseType}}return this};J.prototype.send=function(N){var K,L;this.callback=N||this.callback;if(this.body!==null){K=this.body;if(f.Xhr.sendArrayBufferView){if(K instanceof ArrayBuffer){K=new Uint8Array(K)}}else{if(K.byteOffset===0&&K.buffer instanceof ArrayBuffer){K=K.buffer}}try{this.xhr.send(K)}catch(M){L=M;if(!f.Xhr.sendArrayBufferView&&f.Xhr.wrapBlob){K=new Blob([K],{type:"application/octet-stream"});this.xhr.send(K)}else{throw L}}}else{this.xhr.send()}return this};J.urlEncode=function(K){var N,L,M;N=[];for(L in K){M=K[L];N.push(this.urlEncodeValue(L)+"="+this.urlEncodeValue(M))}return N.sort().join("&")};J.urlEncodeValue=function(K){return encodeURIComponent(K.toString()).replace(/\!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")};J.urlDecode=function(N){var M,K,O,Q,L,P;K={};P=N.split("&");for(Q=0,L=P.length;Q<L;Q++){O=P[Q];M=O.split("=");K[decodeURIComponent(M[0])]=decodeURIComponent(M[1])}return K};J.prototype.onReadyStateChange=function(){var L,K,W,Q,M,P,R,S,T,V,N,O;if(this.xhr.readyState!==4){return true}if(this.completed){return true}this.completed=true;if(this.xhr.status<200||this.xhr.status>=300){K=new f.ApiError(this.xhr,this.method,this.url);if(this.onError){this.onError(K,this.callback)}else{this.callback(K)}return true}if(this.wantHeaders){L=this.xhr.getAllResponseHeaders();if(L){M=f.Xhr.parseResponseHeaders(L)}else{M=this.guessResponseHeaders()}T=M["x-dropbox-metadata"]}else{M=void 0;T=this.xhr.getResponseHeader("x-dropbox-metadata")}if(T!=null?T.length:void 0){try{S=JSON.parse(T)}catch(U){R=U;S=void 0}}else{S=void 0}if(this.responseType){if(this.responseType==="b"){Q=this.xhr.responseText!=null?this.xhr.responseText:this.xhr.response;W=[];for(P=N=0,O=Q.length;0<=O?N<O:N>O;P=0<=O?++N:--N){W.push(String.fromCharCode(Q.charCodeAt(P)&255))}V=W.join("");this.callback(null,V,S,M)}else{this.callback(null,this.xhr.response,S,M)}return true}V=this.xhr.responseText!=null?this.xhr.responseText:this.xhr.response;switch(this.xhr.getResponseHeader("Content-Type")){case"application/x-www-form-urlencoded":this.callback(null,f.Xhr.urlDecode(V),S,M);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(V),S,M);break;default:this.callback(null,V,S,M)}return true};J.parseResponseHeaders=function(L){var O,Q,M,S,K,R,N,P;M={};Q=L.split("\n");for(N=0,P=Q.length;N<P;N++){S=Q[N];O=S.indexOf(":");K=S.substring(0,O).trim().toLowerCase();R=S.substring(O+1).trim();M[K]=R}return M};J.prototype.guessResponseHeaders=function(){var P,L,O,N,K,M;P={};M=["cache-control","content-language","content-range","content-type","expires","last-modified","pragma","x-dropbox-metadata"];for(N=0,K=M.length;N<K;N++){L=M[N];O=this.xhr.getResponseHeader(L);if(O){P[L]=O}}return P};J.prototype.onXdrLoad=function(){var M,K,L;if(this.completed){return true}this.completed=true;L=this.xhr.responseText;if(this.wantHeaders){M={"content-type":this.xhr.contentType}}else{M=void 0}K=void 0;if(this.responseType){this.callback(null,L,K,M);return true}switch(this.xhr.contentType){case"application/x-www-form-urlencoded":this.callback(null,f.Xhr.urlDecode(L),K,M);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(L),K,M);break;default:this.callback(null,L,K,M)}return true};J.prototype.onXdrError=function(){var K;if(this.completed){return true}this.completed=true;K=new f.ApiError(this.xhr,this.method,this.url);if(this.onError){this.onError(K,this.callback)}else{this.callback(K)}return true};return J})();if(typeof module!=="undefined"&&"exports" in module){module.exports=f}else{if(typeof window!=="undefined"&&window!==null){if(window.Dropbox){for(I in f){if(!q.call(f,I)){continue}u=f[I];window.Dropbox[I]=u}}else{window.Dropbox=f}}else{if(typeof self!=="undefined"&&self!==null){self.Dropbox=f}else{throw new Error("This library only supports node.js and modern browsers.")}}}}).call(this);